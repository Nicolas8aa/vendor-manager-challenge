// Create a page to display the user's agreements. Fetch data from the /agreements API.

import { GetServerSideProps, InferGetServerSidePropsType } from "next";
import { getServerSession } from "next-auth";
import React from "react";
import { authOptions } from "./api/auth/[...nextauth]";
import { fetchFromServer } from "@/services/auth";
import AgreementCard from "@/components/Card/Agreement";
import { PageTitle } from "@/components/Text";

// Generated by https://quicktype.io

export interface Agreement {
  id: number;
  terms: string;
  status: string;
  createdAt: string;
  updatedAt: string;
  SupplierId: number;
  BuyerId: number;
}

export const getServerSideProps: GetServerSideProps<{
  agreements: Agreement[];
  allAgreements: Agreement[];
}> = async (context) => {
  const res = await fetchFromServer(
    "/agreements",
    {
      method: "GET",
    },
    context
  );

  const data = await res.json();

  const allRes = await fetchFromServer("/agreements/all", {}, context);

  const allData = await allRes.json();

  return {
    props: {
      agreements: data,
      allAgreements: allData,
    },
  };
};

const Agreements = ({
  agreements,
  allAgreements,
}: InferGetServerSidePropsType<typeof getServerSideProps>) => {
  return (
    <>
      <PageTitle>Active</PageTitle>
      <div className="inline-flex gap-4 z-0">
        {agreements.map((agreements) => {
          return <AgreementCard key={agreements.id} {...agreements} />;
        })}
      </div>

      <PageTitle className="mt-9 mb-3">All</PageTitle>
      <div className="inline-flex gap-4 z-0">
        {allAgreements.map((agreements) => {
          return <AgreementCard key={agreements.id} {...agreements} />;
        })}
      </div>
      {/* <h1 className="text-2xl font-bold my-3">All submissions</h1> */}
    </>
  );
};

export default Agreements;
